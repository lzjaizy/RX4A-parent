<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Web Sql Database</title>
    <link rel="stylesheet" type="text/css" href="easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="easyui/demo/demo.css">
    <script type="text/javascript" src="jquery/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="easyui/jquery.easyui.min.1.3.2.js"></script>

    <style type="text/css">
        table.gridtable {
            font-family: verdana,arial,sans-serif;
            font-size:11px;
            color:#333333;
            border-width: 1px;
            border-color: #666666;
            border-collapse: collapse;
        }
        table.gridtable th {
            border-width: 1px;
            padding: 4px;
            border-style: solid;
            border-color: #666666;
            background-color: #dedede;
        }
        table.gridtable td {
            border-width: 1px;
            padding:0px;
            border-style: solid;
            border-color: #666666;
            background-color: #ffffff;
        }
    </style>

</head>
<body>
    <script type="text/javascript">
        var contextData = [];
        var N = $('#name').val();
        var A = $('#age').val();
        var db;
        window.onload=function () {
            db = openDatabase('testDB', '1.0', '我的测试数据库', 2 * 1024 * 1024);
            setInterval(function(){
                if(navigator.onLine){
                    console.log('online');
                    if (contextData.length > 0){
                        $.ajax({
                            url: 'postData/postToSystem',
                            type: 'post',
                            data: JSON.stringify(contextData),
                            contentType: 'application/json',
                            dataType: 'json',
                            success: function (result) {
                                console.log(result);
                                if (result.code == 200) {
                                    alert('恢复成功');
                                    contextData = [];
                                } else {
                                    alert('发送失败');
                                }
                            }
                        })
                    }
                }else {
                    console.log('outline')
                }
            }, 10000);

        };

        function postToSystem() {
            var temp = {};

            var projectName = $('#name').val();
            var projectInitiator = $('#ini').val();
            var projectData=$('#data').val();
            var projectRemark=$('#remark').val();
            var projectIntroduction=$('#intro').val();


            //var id=1;
            temp.projectName = projectName;
            temp.projectInitiator = projectInitiator;
            temp.projectData = projectData;
            temp.projectRemark = projectRemark;
            temp.projectIntroduction = projectIntroduction;

            contextData.push(temp);
            console.log(contextData);
            if(navigator.onLine){
                $.ajax({
                    url: 'postData/postToSystem',
                    type: 'post',
                    data: JSON.stringify(contextData),
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function (result) {
                        console.log(result);
                        if (result.code == 200) {
                            alert('发送成功');
                            contextData = [];
                        } else {
                            alert('发送失败');
                        }
                    }
                })
            }else{
                alert('网络断开，请等待网络恢复');
                db.transaction(function (context) {
                    context.executeSql('CREATE TABLE IF NOT EXISTS testTable (id unique, projectName,projectInitiator,projectData,projectRemark,projectIntroduction)');

                    context.executeSql('INSERT INTO testTable (id,projectName,projectInitiator,projectData,projectRemark,projectIntroduction) VALUES (1, ' + projectName + ','+ projectInitiator +','+projectData+','+projectRemark+','+projectIntroduction+')');
                });
            }
            console.log(contextData);

        }


    </script>
<div>
<!--    项目名：       &nbsp;&nbsp; <input type="text" name="projectName" id="name"><br><br>-->
<!--    发起人：       &nbsp;&nbsp;&nbsp;<input type="text" name="projectInitiator" id="ini"><br><br>-->
<!--    项目日期：     <input type="text" name="projectData" id="data"><br><br>-->
<!--    项目摘要：     <input type="text" name="projectRemark" id="remark"><br><br>-->
<!--    项目简介：     <input type="text" name="projectIntroduction" id="intro"><br><br>-->
<!--    <button onclick="postToSystem()"> 发送 </button>-->

    <table class="gridtable">
        <tr>
            <th>项目名</th>
            <th>项目发起人</th>
            <th>项目日期</th>
            <th>项目摘要</th>
            <th>项目简介</th>
        </tr>
        <tr>
            <td><input type="text" name="projectName" id="name"  style="width: 100%; height: 100%" ></td>
            <td><input type="text" name="projectName" id="ini"  style="width: 100%; height: 100%" ></td>
            <td><input type="text" name="projectName" id="data"  style="width: 100%; height: 100%" ></td>
            <td><input type="text" name="projectName" id="remark"  style="width: 100%; height: 100%" ></td>
            <td><input type="text" name="projectName" id="intro"   ></td>
        </tr>


    </table>
    <button onclick="postToSystem()"> 发送 </button>














</div>

</body>
</html>